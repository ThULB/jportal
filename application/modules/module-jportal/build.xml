<?xml version="1.0" encoding="ISO-8859-1"?>

<project name="MyCoReModule - JPortal" default="usage" basedir="../..">

    <property name="build.sysclasspath" value="last" />
    <import file="${basedir}/common-modules.xml" />

	<property name="env.MYJPORTAL_HOME" value="${basedir}/../myjportal" />	
	<property name="env.JPORTAL_HOME" value="." />			
	
    <!-- ============================================== -->
    <target name="usage">
        <echo>
          Usage:
            ant [target]

          All targets are internal, use $Docportal/jportal-build.xml

        </echo>
    </target>
    <!-- ============================================== -->

    <target name="webapps" >
        <echo>
			building JPortal-Module webapp
	    </echo>

          	<!-- get JPORTAL sources -->
          	<!-- ############################# -->
        	  	<!-- get editors -->
            <copy todir="${docportal.webapps}/editor">
              <fileset dir="${env.JPORTAL_HOME}/config" includes="editor-*.xml" />
              <fileset dir="${env.JPORTAL_HOME}/config" includes="imports-*.xml" />
            </copy>  	
        	<antcall target="jp.webapps.copyWebPages">
        		<param name="sourcedir.webpages" value="${env.JPORTAL_HOME}/webpages" />
        	</antcall>
        	<antcall target="jp.webapps.copyXSL">
        		<param name="sourcedir.XSL" value="${env.JPORTAL_HOME}/stylesheets" />
        	</antcall>  	
          	
          	<!-- get MYJPORTAL sources -->
          	<!-- ############################# -->  	
        	  	<!-- webpages stuff to "webapps" -->
        	<antcall target="jp.webapps.copyWebPages">
        		<param name="sourcedir.webpages" value="${env.MYJPORTAL_HOME}/webpages" />
        	</antcall>
        	<antcall target="jp.webapps.copyXSL">
        		<param name="sourcedir.XSL" value="${env.MYJPORTAL_HOME}/stylesheets" />
        	</antcall>  	  	
          	<!-- get templates  -->
        	<antcall target="jp.webapps.copyXSL">
        		<param name="sourcedir.XSL" value="${env.MYJPORTAL_HOME}/webpages/templates/master" />
        	</antcall>  	  	  	
    	

        <!-- i18n -->
        <antcall target="properties.merge">
            <param name="module" value="${env.DOCPORTAL_HOME}/modules/module-jportal/config/messages_de.properties" />
            <param name="locale_param" value="de" />
        </antcall>

        <antcall target="properties.merge">
            <param name="module" value="${env.DOCPORTAL_HOME}/modules/module-jportal/config/messages_en.properties"/>
            <param name="locale_param" value="en"/>
        </antcall>
    </target>


  <!-- =================================================================== -->
	<target name="jp.webapps.copyWebPages">
	  	<!-- webpages stuff to "webapps" -->
	    <copy todir="${docportal.webapps}" failonerror="false">
	      <fileset dir="${sourcedir.webpages}" excludes="**/*.xsl" />
	    </copy>  		
	</target>
  <!-- =================================================================== -->	
	<target name="jp.webapps.copyXSL">
	    <copy todir="${docportal.webapps}/WEB-INF/stylesheets" flatten="true" failonerror="false">
	      <fileset dir="${sourcedir.XSL}"   includes="**/*.xsl" />
	    </copy>
	</target>
    <!-- =================================================================== -->
	
    <target name="compile" >
        <echo>Compiling iview-module classes...</echo>
        <antcall target="javac">
            <param name="packages" value="org/mycore/**" />
        </antcall>
    </target>
    <!-- =================================================================== -->
    <target name="javac" depends="init">
        <echo>Compiling ${packages}</echo>
        <javac srcdir="${basedir}/modules/module-jportal/sources" destdir="${basedir}/classes" includes="${packages}" classpathref="mycore.classpath" debug="${debug}" optimize="${optimize}" target="${javatarget}" source="${sourcerelease}" encoding="${sourceencoding}" deprecation="${deprecation}">
        </javac>
    </target>
    <!-- =================================================================== -->
    <target name="init">
        <mkdir dir="${basedir}/classes" />
        <path id="mycore.classpath">
            <fileset dir="${basedir}/lib" includes="*.jar" />
            <fileset dir="${env.MYCORE_HOME}/lib" includes="*.jar" />
        </path>
    </target>
	
    <!-- =================================================================== -->

</project>