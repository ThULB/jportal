<?xml version="1.0" encoding="UTF-8"?>

<!-- ============================================== -->
<!--      MyCoRe-WCMS build file for use with ANT        -->
<!-- $Revision: 1.18 $ $Date: 2006/12/11 13:45:57 $ -->
<!-- ============================================== -->

<project name="MyCoReModule - WCMS" default="usage" basedir="../..">

	<property name="build.sysclasspath" value="last" />
	<import file="${basedir}/common-modules.xml" />

	<!-- ============================================== -->

	<target name="usage">
		<echo level="info">
      All targets are internal!
		</echo>
	</target>
	
	<!-- ============================================== -->	
	
	<target name="webapps">
		<echo level="info">
		      Running MyCoRe-WCMS installation script...
	    </echo>

        <!-- copy mycore.properties.iview.template if it isn't -->
        <copy file="${docportal.modules}/module-wcms/aif/config/mycore.properties.wcms.template" tofile="${docportal.modules}/module-wcms/aif/config/mycore.properties.wcms" overwrite="false" />

				<!-- create log directory -->
		<mkdir dir="${docportal.modules}/module-wcms/aif/archive/logs" />
		
	    <!-- copy libs from MYCORE_HOME -->
	    <copy todir="${build.webapps}/WEB-INF/lib">
	      <fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/lib">
	        <include name="*.jar" />
	      </fileset>
	    </copy>			
		
	    <!-- copy stylesheets from MYCORE_HOME -->
	    <copy todir="${build.webapps}/WEB-INF/stylesheets" flatten="true">
		      <fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/xsl">
		         <include name="**/*.xsl" />
		      </fileset>
	    </copy>

	    <!-- copy web stuff  -->
	    <copy todir="${build.webapps}/modules/module-wcms/aif/web/" preservelastmodified="yes">
	    	<fileset dir="${env.MYCORE_HOME}/modules/module-wcms/aif/web/">
<!--	         <include name="login.xml" />
	         <include name="help.xml" />
-->
    		<include name="*.xml" />
	      </fileset>
	    </copy>
		
	    <!-- copy config data from DOCPORTAL_HOME -->
	    <copy file="${docportal.modules}/module-wcms/aif/config/mycore.properties.wcms" todir="${build.webapps}/WEB-INF/classes" overwrite="true" />

		<!-- ============ web stuff ================== -->
		<!-- noSession info file -->
		<copy todir="${build.webapps}/modules/module-wcms/aif/web/error/" >
			<fileset dir="${docportal.modules}/module-wcms/aif/web/error/" >
		         <include name="noSession.xml" />
			</fileset>
		</copy>				

	    <copy todir="${build.webapps}/WEB-INF/stylesheets" flatten="true">
	  	  <!-- templates -->
			<fileset dir="${docportal.modules}/module-wcms/templates/master">
				<include name="**/*.xsl" />
			</fileset>	  
	    </copy>
		
		<copy todir="${build.webapps}/templates/master/" flatten="false">
	  	  <!-- template wcms -->
			<fileset dir="${docportal.modules}/module-wcms/templates/master/">
		         <exclude name="**/*.xsl" />
			</fileset>
	    </copy>
				
	    <!-- create WCMS working directories ant set permissions -->
        <loadproperties srcFile="${docportal.config}/mycore.properties.private">
		  <filterchain>
		    <linecontains><contains value="MCR.basedir=" /></linecontains>
		  </filterchain>
		</loadproperties>
        <loadproperties srcFile="${docportal.modules}/module-wcms/aif/config/mycore.properties.wcms">
		  <filterchain>
		    <linecontains><contains value="MCR.WebApplication.basedir=" /></linecontains>
		    <tokenfilter>
		      <replacestring from="%MCR.basedir%" to="${MCR.basedir}"/>
		    </tokenfilter>
		  </filterchain>
		</loadproperties>
	    <loadproperties srcFile="${docportal.modules}/module-wcms/aif/config/mycore.properties.wcms">
	      <filterchain>
	        <linecontains>
	          <contains value="MCR.WCMS."/>
	        </linecontains>
		    <tokenfilter>
		      <replacestring from="%MCR.basedir%" to="${MCR.basedir}"/>
			  <replacestring from="%MCR.WebApplication.basedir%" to="${MCR.WebApplication.basedir}"/>
		    </tokenfilter>
	      </filterchain>
	    </loadproperties>

	    <chmod file="${MCR.WCMS.navigationFile}" perm="644"/>
	    <mkdir dir="${MCR.WCMS.backupPath}" />
	    <chmod dir="${MCR.WCMS.backupPath}" perm="755"/>
	    <chmod file="${MCR.WCMS.logFile}" perm="644"/>
	    <chmod file="${MCR.WCMS.footer}" perm="644"/>
	    <mkdir dir="${MCR.WCMS.documentPath}" />
	    <chmod dir="${MCR.WCMS.documentPath}" perm="755"/>
	    <mkdir dir="${MCR.WCMS.imagePath}" />
	    <chmod dir="${MCR.WCMS.imagePath}" perm="755"/>

		<available property="web.xml.present" file="${mycore.modules}/module-wcms/config/web.xml" />
	    <antcall target="do.merge" >
	      <param name="web.xml.file"   value="${mycore.modules}/module-wcms/config/web.xml" />
	    </antcall>

	  	<mcr-config action="addInclude" propertyfile="${build.webapps}/WEB-INF/classes/mycore.properties" value="mycore.properties.wcms"/>

		<antcall target="properties.merge">
			<param name="module" value="${mycore.modules}/module-wcms/config/messages_de.properties"/>
			<param name="locale_param" value="de"/>
		</antcall>
		
		<antcall target="properties.merge">
			<param name="module" value="${mycore.modules}/module-wcms/config/messages_en.properties"/>
			<param name="locale_param" value="en"/>
		</antcall>
	</target>	

  <!-- =================================================================== -->

</project>
