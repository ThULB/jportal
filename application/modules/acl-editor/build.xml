<?xml version="1.0" encoding="UTF-8"?>

<!-- =================================================================== -->
<!--  MyCoRe - Module-ACL-Editor 			                             -->
<!--  												                     -->
<!-- Thomas Scheffler 	- idea, concept				                     -->
<!-- Andreas Trappe 								                     -->
<!-- Chi Vu Huu			- development				                     -->
<!-- =================================================================== -->

<project name="MyCoReModule - ACL-Editor"  basedir="../..">
	
    <import file="${basedir}/common-modules.xml" />
    <import file="${basedir}/build.xml" />	
    <property name="build.sysclasspath" value="last" />
	<property name="module.base" value="acl-editor" />
	<property name="module.dir" value="${basedir}/modules/${module.base}" />
	
	<!-- =================================================================== -->
	<!-- Help on usage                                                       -->
	<!-- =================================================================== -->

	<target name="usage">
		<echo level="info">

      Available targets are:
		create.default-rules --> Add the module dependence rules
        webapps              --> Build the web application directory

      Please do not use any of the other targets, they are internal.
		</echo>
	</target>
	
	<!-- =================================================================== -->
	<!-- Info                                                                -->
	<!-- =================================================================== -->

	<target name="info">
		<echo>${ant.project.name} will include object to handle the ACLs online.</echo>
	</target>
	
	<!-- =================================================================== -->	

	<target name="create.default-rules" description="Load default ACL rules for Module-ACL-Editor">
        <echo level="info">
			building ${ant.project.name}  create.default-rules
	    </echo>
	  	
	    <property name="commands.file" value="${basedir}/commands.txt"/>
	    <echo file="${commands.file}" append="false">
	    	update permission use-aclEditor for id POOLPRIVILEGE with rulefile grant-admins.xml described by ${acl-description.admins}
	    	update permission read for id webpage:/servlets/MCRACLEditorServlet_v2?mode=getACLEditor with rulefile grant-admins.xml described by ${acl-description.admins} 	    	
	    </echo>
	    <antcall target="invoke.cli">
	      <param name="cli.directory" value="${basedir}/config/acl"  />
	      <param name="cli.command"   value="process ${commands.file}" />
	    </antcall>
	    <delete file="${commands.file}" />
	</target>

	<!-- =================================================================== -->

    <target name="webapps" >
        <echo level="info">
			building ${ant.project.name}  webapp
	    </echo>
    	
		<!-- merge web.xml -->
        <available property="web.xml.present" file="${env.MYCORE_HOME}/modules/acl-editor/config/web.xml" />
        <antcall target="do.merge">
            <param name="web.xml.file" value="${env.MYCORE_HOME}/modules/acl-editor/config/web.xml" />
        </antcall>

    	<!-- copy config -->
    	<!-- 
        <mkdir dir="${build.webapps}/modules/acl-editor/config" />    	
        <copy todir="${build.webapps}/modules/acl-editor/config" flatten="false">
            <fileset file="${env.MYCORE_HOME}/modules/acl-editor/config/mcr-module-ACL-editor_v2.xml" />
        </copy>    	    	
    	 -->
         <copy todir="${build.webapps}/WEB-INF/classes">
            <fileset dir="${env.MYCORE_HOME}/modules/acl-editor/config">
                <include name="mycore.properties.ACL-editor" />
            </fileset>
        </copy>
         
        <!-- copy Stylesheets -->
        <copy todir="${build.webapps}/WEB-INF/stylesheets/" preservelastmodified="yes" flatten="false">
            <fileset dir="${env.MYCORE_HOME}/modules/acl-editor/xsl">
                <include name="**/*.xsl" />
            </fileset>
        </copy>
        
    	<!-- copy web stuff -->
        <mkdir dir="${build.webapps}/modules/acl-editor/web" />
        <copy todir="${build.webapps}/modules/acl-editor/web/" flatten="false">
            <fileset dir="${env.MYCORE_HOME}/modules/acl-editor/web" />
        </copy>
        
        <mcr-config propertyfile="${build.webapps}/WEB-INF/classes/mycore.properties" mergeFile="${env.MYCORE_HOME}/modules/acl-editor/config/mycore.properties.ACL-editor" />
        
    </target>

   	<!-- =================================================================== -->	
	
</project>
