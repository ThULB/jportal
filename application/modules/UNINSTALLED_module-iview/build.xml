<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- ============================================== -->
<!--      MyCoRe-iview build file for use with ANT        -->
<!--  												-->
<!-- Image Viewer - MCR-IView 1.0, 05-2006  		-->
<!-- +++++++++++++++++++++++++++++++++++++			-->
<!--  												-->
<!-- Andreas Trappe 	- concept, devel. in misc.  -->
<!-- Britta Kapitzki	- Design					-->
<!-- Thomas Scheffler   - html prototype		    -->
<!-- Stephan Schmidt 	- html prototype			-->
<!-- $Revision: 1.8 $ $Date: 2006/09/18 14:20:36 $ -->
<!-- ============================================== -->

<project name="MyCoReModule - iview" default="usage" basedir="../..">

    <property name="build.sysclasspath" value="last" />
    <import file="${basedir}/common-modules.xml" />

    <!-- ============================================== -->

    <target name="usage">
        <echo>
          Usage:
            ant [target]

          Available targets are:
            install                 --> install module-iview

          Please do not use any of the other targets, they are internal.
        </echo>
    </target>

    <!-- ============================================== -->

    <target name="webapps" depends="synch">
        <echo>
			building IView-Module webapp
	    </echo>

        <!-- copy mycore.properties.iview.template if it isn't -->
        <copy file="${basedir}/modules/module-iview/config/mycore.properties.iview.template" tofile="${basedir}/modules/module-iview/config/mycore.properties.iview" overwrite="false" />
        <!-- copy config -->
        <copy todir="webapps/WEB-INF/classes">
            <fileset dir="${env.DOCPORTAL_HOME}/modules/module-iview/config">
                <include name="mycore.properties.iview" />
            </fileset>
        </copy>

        <!-- copy Stylesheets  -->
        <copy todir="webapps/WEB-INF/stylesheets/" preservelastmodified="yes" flatten="true">
            <fileset dir="${env.DOCPORTAL_HOME}/modules/module-iview/xsl/">
                <include name="**/*.xsl" />
            </fileset>
        </copy>

        <!-- copy web stuff -->
        <mkdir dir="${basedir}/webapps/modules/module-iview/web" />
        <copy todir="${basedir}/webapps/modules/module-iview/web/" flatten="false">
            <fileset dir="${env.DOCPORTAL_HOME}/modules/module-iview/web/" />
        </copy>

        <available property="web.xml.present" file="${env.DOCPORTAL_HOME}/modules/module-iview/config/web.xml" />
        <antcall target="do.merge">
            <param name="web.xml.file" value="${env.DOCPORTAL_HOME}/modules/module-iview/config/web.xml" />
        </antcall>

        <mcr-config action="addInclude"
                    propertyfile="${docportal.webapps}/WEB-INF/classes/mycore.properties"
                    value="mycore.properties.iview" />
        <!-- i18n -->
        <antcall target="properties.merge">
            <param name="module" value="${env.DOCPORTAL_HOME}/modules/module-iview/config/messages_de.properties" />
            <param name="locale_param" value="de" />
        </antcall>

        <antcall target="properties.merge">
            <param name="module" value="${env.DOCPORTAL_HOME}/modules/module-iview/config/messages_en.properties"/>
            <param name="locale_param" value="en"/>
        </antcall>
    </target>

    <!-- =================================================================== -->
    <!-- Compiles the sources from directory sources to directory classes    -->
    <!-- =================================================================== -->

    <target name="compile" depends="synch">
        <echo>Compiling iview-module classes...</echo>
        <antcall target="javac">
            <param name="packages" value="org/mycore/frontend/iview/**" />
        </antcall>
    </target>

    <target name="javac" depends="init">
        <echo>Compiling ${packages}</echo>
        <javac srcdir="${basedir}/modules/module-iview/sources" destdir="${basedir}/classes" includes="${packages}" classpathref="mycore.classpath" debug="${debug}" optimize="${optimize}" target="${javatarget}" source="${sourcerelease}" encoding="${sourceencoding}" deprecation="${deprecation}">
        </javac>
    </target>

    <target name="init">
        <mkdir dir="${basedir}/classes" />

        <path id="mycore.classpath">
            <fileset dir="${basedir}/lib" includes="*.jar" />
            <fileset dir="${env.MYCORE_HOME}/lib" includes="*.jar" />
            <!--			
			<fileset dir="${basedir}/modules/module-iview/lib" includes="*.jar" />
		-->
        </path>

    </target>
	
	<!-- =================================================================== -->
	<!-- Installation													     -->
	<!-- =================================================================== -->

		<target name="install">
			<mkdir dir="${basedir}/modules/module-iview" />
			<copy todir="${basedir}/modules/module-iview" flatten="false">
				<fileset dir="${basedir}/modules/UNINSTALLED_module-iview" excludes="CVS" />
			</copy>	
		</target>

	<!-- =================================================================== -->
	<!-- Synchronisation												     -->
	<!-- =================================================================== -->

		<target name="synch">
			<echo>Synchronisating Module-iview to UNISTALLED-folder</echo>
			<copy todir="${env.DOCPORTAL_HOME}/modules/module-iview" flatten="false">
				<fileset dir="${env.DOCPORTAL_HOME}/modules/UNINSTALLED_module-iview" excludes="CVS" />
			</copy>	
		</target>
		
    <!-- =================================================================== -->

</project>

<!-- ============================================== -->