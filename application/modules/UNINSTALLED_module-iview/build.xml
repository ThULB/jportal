<?xml version="1.0" encoding="UTF-8"?>

<!-- ============================================== -->
<!--      MyCoRe-iview build file for use with ANT        -->
<!--  												-->
<!-- Image Viewer - MCR-IView 1.0, 05-2006  		-->
<!-- +++++++++++++++++++++++++++++++++++++			-->
<!--  												-->
<!-- Andreas Trappe 	- concept, devel. in misc.  -->
<!-- Britta Kapitzki	- Design					-->
<!-- Thomas Scheffler   - html prototype		    -->
<!-- Stephan Schmidt 	- html prototype			-->
<!-- $Revision: 1.11 $ $Date: 2006/12/11 13:45:57 $ -->
<!-- ============================================== -->

<project name="MyCoReModule - iview" default="usage" basedir="../..">

    <property name="build.sysclasspath" value="last" />
    <import file="${basedir}/common-modules.xml" />

    <!-- ============================================== -->

    <target name="usage">
        <echo level="info">
          Usage:
            ant [target]

          Available targets are:
            install                 --> install module-iview

          Please do not use any of the other targets, they are internal.
        </echo>
    </target>

    <!-- ============================================== -->

    <target name="webapps" depends="synch">
        <echo level="info">
			building IView-Module webapp
	    </echo>

        <!-- copy mycore.properties.iview.template if it isn't -->
        <copy file="${docportal.modules}/module-iview/config/mycore.properties.iview.template" tofile="${basedir}/modules/module-iview/config/mycore.properties.iview" overwrite="false" />
        <!-- copy config -->
        <copy todir="${build.webapps}/WEB-INF/classes">
            <fileset dir="${docportal.modules}/module-iview/config">
                <include name="mycore.properties.iview" />
            </fileset>
        </copy>

        <!-- copy Stylesheets  -->
        <copy todir="${build.webapps}/WEB-INF/stylesheets/" preservelastmodified="yes" flatten="true">
            <fileset dir="${docportal.modules}/module-iview/xsl/">
                <include name="**/*.xsl" />
            </fileset>
        </copy>

        <!-- copy web stuff -->
        <mkdir dir="${build.webapps}/modules/module-iview/web" />
        <copy todir="${build.webapps}/modules/module-iview/web/" flatten="false">
            <fileset dir="${docportal.modules}/module-iview/web/" />
        </copy>

        <available property="web.xml.present" file="${docportal.modules}/module-iview/config/web.xml" />
        <antcall target="do.merge">
            <param name="web.xml.file" value="${docportal.modules}/module-iview/config/web.xml" />
        </antcall>

        <mcr-config action="addInclude"
                    propertyfile="${build.webapps}/WEB-INF/classes/mycore.properties"
                    value="mycore.properties.iview" />
        <!-- i18n -->
        <antcall target="properties.merge">
            <param name="module" value="${docportal.modules}/module-iview/config/messages_de.properties" />
            <param name="locale_param" value="de" />
        </antcall>

        <antcall target="properties.merge">
            <param name="module" value="${docportal.modules}/module-iview/config/messages_en.properties"/>
            <param name="locale_param" value="en"/>
        </antcall>
    </target>

    <!-- =================================================================== -->
    <!-- Compiles the sources from directory sources to directory classes    -->
    <!-- =================================================================== -->

    <target name="compile" depends="synch">
        <echo level="info">Compiling iview-module classes...</echo>
        <antcall target="javac">
            <param name="packages" value="org/mycore/frontend/iview/**" />
        </antcall>
    </target>

    <target name="javac" depends="init">
        <echo level="info">Compiling ${packages}</echo>
        <javac 
			srcdir="${basedir}/modules/module-iview/sources" 
			destdir="${build.classes}" includes="${packages}" 
			classpathref="docportal.classpath" 
			debug="${debug}" 
			optimize="${optimize}" 
			target="${javatarget}" 
			source="${sourcerelease}" 
			encoding="${sourceencoding}" 
			deprecation="${deprecation}">
        </javac>
    </target>

    <target name="init">
        <path id="mycore.classpath">
            <fileset dir="${build.lib}" includes="*.jar" />
        </path>
    </target>
	
	<!-- =================================================================== -->
	<!-- Installation													     -->
	<!-- =================================================================== -->

		<target name="install">
			<mkdir dir="${docportal.modules}/module-iview" />
			<copy todir="${docportal.modules}/module-iview" flatten="false">
				<fileset dir="${docportal.modules}/UNINSTALLED_module-iview" excludes="CVS" />
			</copy>	
		</target>

	<!-- =================================================================== -->
	<!-- Synchronisation												     -->
	<!-- =================================================================== -->

		<target name="synch">
			<echo level="info">Synchronisating Module-iview to UNISTALLED-folder</echo>
			<copy todir="${docportal.modules}/module-iview" flatten="false">
				<fileset dir="${docportal.modules}/UNINSTALLED_module-iview" excludes="CVS" />
			</copy>	
		</target>
		
    <!-- =================================================================== -->

</project>

<!-- ============================================== -->