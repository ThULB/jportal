evaluationDependsOn(':jportal_mcr_module')

def mcrVersion = '2014.07-SNAPSHOT'
def jettyVersion = "9.2.2.v20140723"

def getDate() {
    def date = new Date()
    def formattedDate = date.format('yyyyMMdd.HHmmss')
    return formattedDate
}

allprojects {
    apply plugin: 'java'
    apply plugin: 'maven'
    apply plugin: 'eclipse'

    group = "fsu.thulb"
    version = "2.0.18-SNAPSHOT"
    repositories {
        mavenLocal()

        maven{ url "http://artifactory.mycore.de/mycore-releases" }

        maven{ url "http://artifactory.mycore.de/mycore-snapshots" }
        
    }
    
    dependencies{
        compile "org.mycore:mycore-base:$mcrVersion"
        compile "org.mycore:mycore-solr:$mcrVersion"
        compile "org.mycore:mycore-mets:$mcrVersion"
        compile "org.mycore:mycore-iview2:$mcrVersion"
        compile "org.mycore:mycore-user2:$mcrVersion"
        compile "org.mycore:mycore-classeditor:$mcrVersion"
        compile "org.mycore:mycore-mets:$mcrVersion"
        compile "org.mycore:mycore-oai:$mcrVersion"
        compile 'org.mycore.legacy:mycore-legacy-search:1.0-SNAPSHOT'
        compile 'org.mycore.sru:sru-adapter:0.0.1-SNAPSHOT'
        compile 'org.mycore.mets:mets-model:0.5-SNAPSHOT'
        compile 'javax.servlet:javax.servlet-api:3.1.0'
        compile 'fsu.archiv.mycore.sru:sru-pica-import:0.0.1-SNAPSHOT'
        compile 'org.apache.maven:maven-core:3.0.4'
        testCompile group: 'junit', name: 'junit', version: '4.+'
        testCompile group: 'org.mycore', name: 'mycore-base', version: mcrVersion, classifier: 'tests'
    }
}

subprojects {
    if(project.name.equals("jportal_webapp")){
        apply plugin: 'war'

        configurations { jetty }

        dependencies {
            jetty "org.eclipse.jetty:jetty-runner:$jettyVersion"
            runtime project(":jportal_webapp_wizard")
        }
        
        task runJetty(type: JavaExec) {
            main = "org.eclipse.jetty.runner.Runner"
            println(war.archivePath)
            args '--config', 'jetty/jetty-config.xml'
            args '--path', 'jportal_webapp'
            args war.archivePath
            classpath configurations.jetty
        }

    }
    
    if(project.name.equals("jportal_webapp_wizard")){
        jar {
            manifest {
                attributes("MCR-Application-Module": "$project.name")
                attributes("MCR-Artifact-Id": "$project.name")
                attributes("version": "$project.version")
                attributes("timestamp": getDate())
            }
            
        }
    }

    if(project.name.equals("jportal_mcr_module")){
        dependencies{
            compile project(':jportal-commons')
            compile project(':jportal_ext_web_lib')
            compile project(':jportal_iview2_plugin')
            compile 'de.uni-jena.thulb:JPJaxbPojos:0.0.1-SNAPSHOT'
            compile 'de.uni-jena.thulb.oai:archive-oai-resources:0.0.1-SNAPSHOT'
            compile 'log4j:log4j:1.2.17'
            compile 'com.sun.jersey.jersey-test-framework:jersey-test-framework-grizzly:1.17'
            compile 'com.sun.jersey.contribs:jersey-apache-client:1.17'
            compile 'com.sun.jersey:jersey-client:1.17'
            compile 'com.sun.jersey:jersey-server:1.17'
            compile 'org.easymock:easymock:3.2'
            compile 'xmlunit:xmlunit:1.3'
            compile 'javax.xml.bind:jaxb-api:2.2.1'
            compile 'com.sun.xml.bind:jaxb-impl:2.2.1.1'

            jar {
                manifest {
                    attributes("MCR-Application-Module": "$project.name")
                    attributes("MCR-Artifact-Id": "$project.name")
                    attributes("version": "$project.version")
                    attributes("timestamp": getDate())
                }
            }
        }
    } else if(!project.name.equals("jportal-commons") && !project.name.equals("jportal_ext_web_lib") && !project.name.equals("jportal_iview2_plugin")){
        dependencies{ compile project(':jportal_mcr_module') }
    }
}

configurations.all {
    resolutionStrategy.cacheDynamicVersionsFor 0, 'minutes'
}


dependencies { compile project(':jportal_mcr_module') }