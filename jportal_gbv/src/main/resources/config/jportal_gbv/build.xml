<?xml version="1.0" encoding="UTF-8"?>
<project name="jportal_gbv" xmlns:mcr="antlib:org.mycore.buildtools">
	<import file="${basedir}/common-modules.xml" />
	<import file="${basedir}/build.xml" />

	<property name="module.directory" location="${ant.file}/.." />
	<property file="${module.directory}/build.properties" />
	<property name="module.jar" location="${build.lib}/${module.jar.name}" />

	<property name="jportal.directory" location="${ant.file}/../../jportal_mcr" />

	<target name="create.default-rules" description="loads default acl rules for archive application">
		<echo>Default rules</echo>
		<antcall target="invoke.cli">
			<param name="cli.directory" value="${jportal.directory}/acl" />
			<param name="cli.command" value="process defaultrules-commands" />
		</antcall>
	</target>

	<target name="create.users">
		<echo>Create users and groups</echo>
		<antcall target="invoke.cli">
			<param name="cli.directory" value="${jportal.directory}/usersAndGroups" />
			<param name="cli.command" value="process usersAndGroups-commands" />
		</antcall>
	</target>

	<target name="config">
		<echo>JPortal: config</echo>
		<mcr:config action="addInclude" propertyfile="${build.config}/mycore.properties" key="MCR.CLI.Classes.Annotated" value="MigratingCMDs" />
		<mcr:config action="addInclude" propertyfile="${build.config}/mycore.properties" key="MCR.Jersey.resource.packages" value="fsu.jportal.resources" />
	</target>

	<target name="create.webapp">

		<echo>JPortal-GBV create.webapp</echo>

		<unjar dest="${build.webapps}" overwrite="true">
			<fileset file="${module.jar}" />
			<patternset>
				<include name="META-INF/resources/content/below/index.xml" />
			</patternset>
			<regexpmapper from="^(META-INF/resources/)(.*)" to="\2" />
		</unjar>
		<unjar dest="${build.webapps}/WEB-INF/classes" overwrite="true">
			<fileset file="${module.jar}" />
			<patternset>
				<include name="xsl/generatePage.xsl" />
			</patternset>
		</unjar>
		<unjar dest="${build.webapps}" overwrite="true">
			<fileset file="${module.jar}" />
			<patternset>
				<include name="META-INF/resources/templates/**" />
			</patternset>
			<regexpmapper from="^(META-INF/resources/)(templates/.*)" to="\2" />
		</unjar>
		<unjar dest="${build.webapps}/WEB-INF/classes" overwrite="true">
			<fileset file="${module.jar}" />
			<patternset>
				<include name="xsl/sitemap.xsl" />
			</patternset>
		</unjar>

		<copy todir="${basedir}/config/solr-home">
			<fileset dir="${jportal.directory}/solr" />
		</copy>

	</target>


</project>
