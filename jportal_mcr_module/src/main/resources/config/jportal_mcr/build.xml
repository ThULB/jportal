<?xml version="1.0" encoding="UTF-8"?>
<project name="jportal_mcr">
	<import file="${basedir}/common-modules.xml" />
	<property name="module.directory" location="${ant.file}/.." />
	<property file="${module.directory}/build.properties" /> 
	<property name="module.jar" location="${build.lib}/${module.jar.name}" />

	<target name="create.default-rules" description="loads default acl rules for archive application">
		<echo>Default rules</echo>
		<antcall target="invoke.cli">
			<param name="cli.directory" value="${module.directory}/acl" />
			<param name="cli.command" value="process defaultrules-commands" />
		</antcall>
		<echo>Web ACL</echo>
		<antcall target="invoke.cli">
			<param name="cli.directory" value="${module.directory}/acl" />
			<param name="cli.command" value="process webacl-commands" />
		</antcall>
	</target>

	<target name="create.users">
		<echo>Create users and groups</echo>
		<antcall target="invoke.cli">
			<param name="cli.directory" value="${module.directory}/usersAndGroups" />
			<param name="cli.command" value="process usersAndGroups-commands" />
		</antcall>
	</target>

	<target name="create.webapp">
		<echo>JPortal webapp</echo>

		<echo>Copy JPortal Stuff</echo>
		<copy todir="${build.webapps}" flatten="true" preservelastmodified="true">
			<fileset dir="${module.directory}/editor/form" includes="**/*.xml" />
			<fileset dir="${module.directory}/editor/error" includes="**/*.xml" />
			<fileset dir="${module.directory}/editor/restore" includes="**/*.xml" />
			<fileset dir="${module.directory}" includes="fileMappings.xml" />
		</copy>

		<copy todir="${build.webapps}/editor" flatten="true" preservelastmodified="true">
			<fileset dir="${module.directory}/editor/common" includes="**/*.xml" />
		</copy>

		<copy todir="${build.webapps}/WEB-INF/classes/" flatten="true" preservelastmodified="true">
			<fileset dir="${module.directory}/editor/acl" includes="**/*.xml" />
		</copy>

		<unjar dest="${build.webapps}/WEB-INF/classes/xsl" overwrite="true">
			<fileset file="${module.jar}" />
			<patternset>
				<include name="xsl/*.xsl" />
			</patternset>
		</unjar>

		<unjar dest="${build.webapps}" overwrite="true">
			<fileset file="${module.jar}" />
			<patternset>
				<include name="web/WEB-INF/**" />
				<include name="web/config/navigation.xml" />
			</patternset>
			<regexpmapper from="^(web/)(.*)" to="\2" />
		</unjar>

	</target>
</project>
